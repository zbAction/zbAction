!function(a,b){var c=function(){return this instanceof c?void(this._events={}):new c};c.prototype._ws=null,c.prototype._onload=null,c.prototype._onclose=null,c.prototype.on=function(a,b){if(!a)throw"No event specified.";if(!b)throw"No callback specified.";this._events[a]=this._events[a]||[],this._events[a].push(b)},c.prototype.off=function(a,c){if(a&&a in this._events!=!1){if(c===b)return void delete this._events[a];var d=this._events[a].indexOf(c);this._events[a].splice(d,1)}},c.prototype.emit=function(a){if(a&&a in this._events!=!1)for(var b=0;b<this._events[a].length;b++){var c=this._events[a][b],d=Array.prototype.slice.call(arguments,1);c.apply(this,d)}},c.prototype.load=function(a){this._ws=new WebSocket(a);var b=this;this._ws.onopen=function(){b._onload&&b._onload.apply(b,arguments)},this._ws.onmessage=function(a){var c=JSON.parse(a.data);b.emit(c.event,c)},this._ws.onclose=function(){b._onclose&&b._onclose.apply(b,arguments),b._ws=null}},c.prototype.onload=function(a){this._onload=a},c.prototype.send=function(a){if(!this._ws)throw"You must connect to a websocket first.";this._ws.send(JSON.stringify(a))},c.prototype.onclose=function(a){this._onclose=a},a.Socket=c}(window),function(a,b,c){var d,e,f;-1!==location.href.indexOf("localhost:")?(d="ws://localhost:4242/gateway",e="http://localhost:4343/api/mods/list/",f="http://localhost:4343/api/users/list/"):(d="wss://zbaction.reticent.io/gateway",e="https://zbaction.reticent.io/api/mods/list/",f="https://zbaction.reticent.io/api/users/list/");var g=1e4,h={},i={by_uid:function(a){return a=""+a,h[a]||null},by_name:function(a){for(var b in h)if(h[b]===a)return b;return null}},j=a.__zbAction.board_key;delete a.__zbAction;var k=function(){if(!(this instanceof k))return new k;var a=b(),c=this;this._wait={};var l=[],m={board_key:j,bpath:$.zb.stat.bpath,uid:$.zb.stat.mid,name:$('#top_info strong a[href*="/profile/"]').text()};a.onload(function(){a.send({key:0,type:"handshake",data:m})});var n=function(){$(document).ready(function(){m.name=$('#top_info strong a[href*="/profile/"]').text(),a.load(d)})};n(),a.onclose(function(){l.forEach(function(a){a.call(c)})});var o=function(b,c,d){if(!u.hasOwnProperty(c)){var e=this;a.on(b+"."+c,function(a){a.event=a.event.replace(b+".",""),d.call(e,a)})}},p=function(a){l.push(a)},q=function(a,b){this.send=a.bind(null,b),this.register=o.bind(this,b),this.users=i,this.error=p},r=function(b){var d=b.mods||[];for(var e in c._wait)-1!==d.indexOf(e)&&c._wait[e].call(null,new q(t,e));a.send({key:0,type:"get_unread",data:m})},s=function(){var b=new Date;a.on("heartbeat",function(){b=new Date}),a.send({key:0,type:"heartbeat",data:"heartbeat"});var d=function(){var a=new Date;if(a-b>g+1){t=null;try{c._wait={},l=[],n()}catch(e){}}setTimeout(d,g)};setTimeout(d,g)},t=null,u={handshake:function(b){if(null===t){var c=b.details;t=function(b,d){try{if(d.receiver.board_key||(d.receiver.board_key=m.board_key),d.receiver.board_key!==m.board_key)throw new Error("Cross-board requests are not allowed.");d.details=JSON.stringify(d.details),d={event:(b+"."+d.event).substring(0,255),details:d.details.substring(0,1e4),source:m,timestamp:d.timestamp,receiver:{uid:parseInt(d.receiver.uid),board_key:d.receiver.board_key}}}catch(e){if("TypeError"===e.name)throw new Error("Invalid action data provided.");throw e}a.send({key:c,mod_key:b,type:"action",data:d})},$.getJSON(f+m.board_key,function(a){h=a.users}).done(function(){s(),$.getJSON(e+m.board_key).then(r)})}}};for(var v in u)u.hasOwnProperty(v)&&a.on(v,u[v])};k.prototype.ready=function(a,b){if("string"!=typeof a)throw"You must specify an API key.";if("function"!=typeof b)throw"You must specify a function.";this._wait[a]=b},a.zbAction=new k}(window,Socket);